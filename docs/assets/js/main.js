"use strict";const inputSearch=document.querySelector("#input-search"),buttonSearch=document.querySelector("#btn-search"),showList=document.querySelector("#show-list"),formSearch=document.querySelector("#form-search"),favList=document.querySelector("#fav-list"),resetFavs=document.querySelector("#btn-reset");let favourites=[];function getShowsFromAPI(){const e=inputSearch.value;fetch(`http://api.tvmaze.com/search/shows?q=${e}`).then(e=>e.json()).then(e=>{0!==e.length?paintShows(e):paintError()})}function paintShows(e){clearSearch();const t=document.createElement("ul");t.classList.add("search-list"),showList.appendChild(t);for(let a of e){const e=a.show,o=document.createElement("li");o.classList.add("search-item");const s=e.id,r=e.name,i=document.createElement("h2");i.setAttribute("id",s),i.classList.add("select-item");const n=document.createElement("img");n.classList.add("show-image");const c=document.createTextNode(r);i.appendChild(c),null!==e.image?n.src=e.image.medium:n.src="./assets/images/image-unavailable.png",o.appendChild(i),o.appendChild(n),t.appendChild(o),o.addEventListener("click",selectShow),o.addEventListener("click",saveShow),o.addEventListener("click",showSelectedFavourites)}showSelectedFavourites()}function paintError(){clearSearch();const e=document.createElement("p");e.classList.add("error-message");const t=document.createTextNode("Lo siento mucho, no conozco esta serie.");e.appendChild(t),showList.appendChild(e)}function introSearch(){event.preventDefault(),animateSearchBar()}function clearSearch(){""!==showList.innerHTML&&(showList.innerHTML=""),closeFavList()}function selectShow(e){e.currentTarget.classList.toggle("selected")}function saveShow(e){const t=e.currentTarget.querySelector(".select-item"),a=e.currentTarget.querySelector(".show-image");let o={name:t.innerHTML,id:t.getAttribute("id"),image:a.src};if(null!==JSON.parse(localStorage.getItem("favourites")))if(e.currentTarget.classList.contains("selected"))favourites.push(o),localStorage.setItem("favourites",JSON.stringify(favourites)),paintFavourites(o);else{o={},favourites=JSON.parse(localStorage.getItem("favourites"));const e=findArrayIndex(t.getAttribute("id"),favourites);favourites.splice(e,1),localStorage.setItem("favourites",JSON.stringify(favourites))}else(favourites=[]).push(o),localStorage.setItem("favourites",JSON.stringify(favourites)),paintFavourites(o);updateCounter()}function paintFavourites(e){const t=document.createElement("li");t.classList.add("fav-list-element");const a=document.createElement("span");a.setAttribute("id",e.id);const o=document.createTextNode(e.name),s=document.createElement("img"),r=document.createElement("span"),i=document.createElement("i");i.classList.add("close-icon","fas","fa-times-circle"),s.src=e.image,r.appendChild(i),a.appendChild(o),t.appendChild(a),t.appendChild(s),t.appendChild(r),favList.appendChild(t),r.addEventListener("click",removeFromFavList)}function findArrayIndex(e,t){for(let a=0;a<t.length;a++)if(t[a].id===e)return t.indexOf(t[a])}function removeFromFavList(e){e.currentTarget.closest("li").classList.add("hidden"),favourites=JSON.parse(localStorage.getItem("favourites"));const t=findArrayIndex(e.currentTarget.closest("span").getAttribute("id"),favourites);favourites.splice(t,1),localStorage.setItem("favourites",JSON.stringify(favourites)),updateCounter(),favourites.length<1&&closeFavList()}function loadFavourites(){if(favList.innerHTML="")favList.innerHTML="<p>Tu lista está vacía.</p>";else if(favList.innerHTML="",null!==localStorage.getItem("favourites")||""!==localStorage.getItem("favourites")){favourites=JSON.parse(localStorage.getItem("favourites"));for(let e of favourites)paintFavourites(e)}else favList.innerHTML="";updateCounter()}function showSelectedFavourites(){if(null!==localStorage.getItem("favourites")){const e=document.querySelectorAll(".search-item");favourites=JSON.parse(localStorage.getItem("favourites"));for(let t of e){const e=t.querySelector(".select-item");for(let a of favourites)a.id==e.getAttribute("id")&&t.classList.add("selected")}}}function resetFavList(){favList.innerHTML="",localStorage.removeItem("favourites"),favCounter.innerHTML="0";const e=document.querySelectorAll(".selected");for(let t of e)t.classList.remove(".selected");closeFavList()}function removeSelected(){favourites=JSON.parse(localStorage.getItem("favourites"));const e=document.querySelectorAll(".selected");if(null===favourites)return favourites=[];for(let t of e){const e=t.querySelector(".select-item").getAttribute("id");null!==favourites&&favourites.includes(e)||t.classList.remove("selected")}}buttonSearch.addEventListener("click",animateSearchBar),formSearch.addEventListener("submit",introSearch),window.addEventListener("load",loadFavourites),resetFavs.addEventListener("click",resetFavList);const favCounter=document.querySelector("#fav-counter"),favTop=document.querySelector("#fav-top"),favBottom=document.querySelector("#fav-bottom"),favArrow=document.querySelector("#fav-arrow"),headerTitle=document.querySelector("#header-title"),headerIcon=document.querySelector("#icon");function updateCounter(){favourites=JSON.parse(localStorage.getItem("favourites")),favCounter.innerHTML=favourites.length}function toggleFavList(){null!==(favourites=JSON.parse(localStorage.getItem("favourites")))?(favBottom.classList.toggle("fav-bottom--open"),favArrow.classList.toggle("fav-arrow-open")):alert("¡Todavía no tienes series guardadas en favoritas! Busca y añade seleccionándolas."),loadFavourites(),removeSelected()}function closeFavList(){favBottom.classList.contains("fav-bottom--open")&&(favBottom.classList.remove("fav-bottom--open"),favArrow.classList.remove("fav-arrow-open")),removeSelected()}function animateSearchBar(){inputSearch.classList.add("input-animated"),buttonSearch.classList.add("btn-animated"),headerTitle.classList.add("title-animated"),headerIcon.classList.add("icon-animated"),setTimeout(getShowsFromAPI,500)}favTop.addEventListener("click",toggleFavList);